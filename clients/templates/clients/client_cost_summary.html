{% extends 'site/base.html' %}

{% block title %}Support Cost Calculator{% endblock %}
   
    {% block head_css_section %}
    {% endblock head_css_section %}

    {% block head_css_page %}
        <style>
        .channel-link{
                
            font-size: 11px
        }

    </style>
    {% endblock head_css_page %}

{% block head_js %}
<script type="text/javascript">
    function changeClient(obj){
        urlString = "http://localhost:8000/client/client/"
        var selectedClient = obj.value;
        
        if (selectedClient.value != ""){
            window.location = urlString + selectedClient;
        }
    }
</script>
{% endblock head_js %}
{% block pagetitle %}Support Cost Form{% endblock pagetitle %}
{% block content %}
    <div class="container" id="services">   
        <form action="" method="post">
            {% csrf_token %}
            <div class='hide'>
                    <input id="support_cost" type="text" name="support_cost" value={{ cost }} v-model="support_cost">
                </div>
            <ul class="collapsible collapsible-accordion" >
                <li>
                    <div class="collapsible-header"><i class="material-icons">people</i>Support Summary - ${{cost}} /month</div>
                    <div class="collapsible-body">
                        {% for channel, hours in support.items %}
                            <ul class="collection with-header">
                                <li class="collection-header"><h4>{{channel|capfirst}}</h4></li>
                            {% for hour, cost in hours.items %}
                                <li class="collection-item">{{hour|capfirst}} - ${{cost}}</li>
                            {% endfor %}
                            </ul>
                        {% endfor %}
                    </div>
                </li>
                <li class="active">
                    <div class="collapsible-header"><i class="material-icons">bubble_chart</i>Additional Services - {% verbatim %} {{additionalCost}} {% endverbatim %}</div>
                    <div class="collapsible-body">
                        <div>
                            {% for service, cost in additional_service.items %}
                            <p>
                                <input type="checkbox" id="{{service}}" value="{{cost}}" v-model="additional_cost"/>
                                <label for="{{service}}">{{service}} - ${{cost}}</label>  
                            </p>
                            {% endfor %}
                        </div>
                    </div>
                </li>
            </ul>

            <div class="row" id="total">
                <div class="col s4 offset-s8">
                    <h5>Total {% verbatim %} {{totalCost}} {% endverbatim %}</h5>
                </div>
            </div>
            <div class="row">
                <div class="col s2">
                     <button class="btn waves-effect waves-light" v-on:click="savePDF">Save PDF
                        <i class="material-icons right">send</i>
                      </button>
                </div>
            </div>
        </form>
    </div>
{% endblock content %}

{% block footer_javascript_page %}
<script>
    $(document).ready(function(){
        $('.collapsible').collapsible();
    });
    
     
    
    var app = new Vue({
        el: '#services',
        data: {
            additional_cost: [],
            support_cost: {{cost}},
        },
        computed: {
            additionalCost(){
                var total = this.additional_cost.reduce((acc, item) => acc + Number(item), 0);
                return "$" + total + " /month";
                
            },
            totalCost(){
                var total = this.additional_cost.reduce((acc, item) => acc + Number(item), 0) + this.support_cost;
                return "$" + total + " /month";
            }
            
        },
        methods: {
            savePDF: function() {
            var divContents = $("#services").html();
            var printWindow = window.open('', '', 'height=400,width=800');
            printWindow.document.write('<html><head><title>Support Cost</title>');
            printWindow.document.write('</head><body >');
            printWindow.document.write(divContents);
            printWindow.document.write('</body></html>');
            printWindow.document.close();
            printWindow.print();
        },
        }
        
    });
</script>
{% endblock footer_javascript_page %}
